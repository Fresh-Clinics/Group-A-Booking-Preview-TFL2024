<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calendar with Hardcoded Events</title>

    <!-- Include FullCalendar Scheduler CSS -->
    <link href="https://cdn.jsdelivr.net/npm/@fullcalendar/core@6.1.15/main.min.css" rel="stylesheet" />
    <link href="https://cdn.jsdelivr.net/npm/@fullcalendar/resource-timegrid@6.1.15/main.min.css" rel="stylesheet" />

    <!-- Include Tippy.js for tooltips -->
    <link href="https://unpkg.com/tippy.js@6/dist/tippy.css" rel="stylesheet" />

    <!-- Include custom styles -->
    <link rel="stylesheet" href="style.css">

    <!-- Include FullCalendar Scheduler JS -->
    <script src="https://cdn.jsdelivr.net/npm/@fullcalendar/core@6.1.15/main.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@fullcalendar/resource-common@6.1.15/main.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@fullcalendar/resource-timegrid@6.1.15/main.min.js"></script>

    <!-- Include Tippy.js for tooltips -->
    <script src="https://unpkg.com/@popperjs/core@2"></script>
    <script src="https://unpkg.com/tippy.js@6"></script>

    <!-- Include jQuery -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

    <!-- Include JSON-RPC Client Library -->
    <script src="json-rpc-client.js"></script>
</head>
<body>

<div id="calendar"></div>

<script>
$(document).ready(function () {
    console.log("Initializing Calendar with Hardcoded Data...");

    // Fetch event data from 'event-data.js'
    $.getJSON('event-data.js', function(eventData) {
        // Fetch start time data from 'start-times.js' after event data has been successfully loaded
        $.getJSON('start-times.js', function(startTimeData) {
            // Initialize calendar with the fetched data
            initializeCalendar(eventData, startTimeData);
        }).fail(function(jqxhr, textStatus, error) {
            console.error("Failed to load start time data. Error: " + textStatus + ", " + error);
        });
    }).fail(function(jqxhr, textStatus, error) {
        console.error("Failed to load event data. Error: " + textStatus + ", " + error);
    });

    function initializeCalendar(eventData, startTimeData) {
        var calendarEl = document.getElementById('calendar');
        var calendar = new FullCalendar.Calendar(calendarEl, {
            schedulerLicenseKey: 'CC-Attribution-NonCommercial-NoDerivatives',
            initialView: 'resourceTimeGridDay',
            initialDate: '2024-10-29',
            timeZone: 'Australia/Sydney',
            headerToolbar: {
                left: 'prev',
                center: 'title',
                right: 'next'
            },
            dayMinWidth: 150,
            resources: getHardcodedResources(),
            events: function (info, successCallback, failureCallback) {
                const processedEvents = processEvents(eventData, startTimeData, info.startStr, info.endStr);
                successCallback([...processedEvents, ...getHardcodedEvents()]);
            },
            height: 'auto',
            slotMinTime: '07:00',
            slotMaxTime: '23:00',
            resourceOrder: 'order_id',
            businessHours: [
                { daysOfWeek: [2], startTime: '09:00', endTime: '18:30' },
                { daysOfWeek: [3], startTime: '07:30', endTime: '19:00' },
                { daysOfWeek: [4], startTime: '07:00', endTime: '22:30' }
            ],
            eventContent: function (arg) {
                if (arg.event && arg.event.title) {
                    const borderColor = getCategoryBorderColor(arg.event.extendedProps.category);
                    return {
                        html: `<div class="fc-event-content" style="border-top: 4px solid ${borderColor} !important; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">
                                  <div class="fc-event-title">${arg.event.title}</div>
                                  <div class="fc-event-slots">${arg.event.extendedProps.displaySlots ? `Slots Available: ${arg.event.extendedProps.bookings_limit}` : ''}</div>
                               </div>`
                    };
                } else {
                    return { html: '<div class="fc-event-content"><div class="fc-event-title">Invalid Event</div></div>' };
                }
            },
            eventDidMount: function (info) {
                tippy(info.el, {
                    content: `<strong>${info.event.title}</strong><br>${info.event.extendedProps.description}`,
                    allowHTML: true,
                    theme: 'light-border',
                    placement: 'top'
                });
            },
            eventClick: function (info) {
                const event = info.event;
                const popup = document.createElement('div');
                popup.className = 'popup-overlay';
                popup.innerHTML = `
                    <div class="popup-content">
                        <span class="close-popup" onclick="this.parentElement.parentElement.remove()">Ã—</span>
                        <img src="${getResourceLogo(event.resourceId)}" style="width: 100px; margin: 10px auto;" alt="Resource Logo">
                        <p><strong>${formatTimeToAEST(new Date(event.extendedProps.rawStartTime))} - ${formatTimeToAEST(new Date(event.extendedProps.rawEndTime))}</strong></p>
                        <h3>${event.title}</h3>
                        <p>${event.extendedProps.description}</p>                  
                        <div class="popup-footer">Bookings open Monday 23rd October at 7:00PM AEST</div>
                    </div>
                `;
                document.body.appendChild(popup);
            },
            allDaySlot: false
        });

        calendar.render();
    }

    // Functions for processing events and other utilities
    // Add the complete functions like processEvents, getHardcodedResources, getHardcodedEvents, etc., here
});
</script>

</body>
</html>
